# Handoff (краткий бриф)

## 1) Цель
Сделать **минималистичную и корректную** реализацию ключевого компонента на Go, сохранив внешний контракт и восстановив прохождение тестов. Максимум свободы в выборе архитектурных приёмов.

## 2) Источники контекста (по приоритету)
- **Документация продукта** в `docs/` (описания сценариев, диаграммы, формат данных).
- **Рабочая ветка проекта** `resbuilder-optimization/` (актуальная реализация до неудачного рефакторинга).
- **Попытка рефакторинга** `docs/resbuilder-optimization` и `internal/xds/resbuilder_v2` — как источник идей и анти‑примеров (брать только полезные находки).
- История в **git log**

## 3) Постановка задачи
- Вернуть зелёные тесты: `go test ./...` и желателен `-race`.
- Упростить код: убрать мёртвое/дубли, удалить бесполезные абстракции.
- Не гнаться за «идеальной» архитектурой. Цель — простая поддерживаемая реализация.

## 4) Критерии успеха (Definition of Done)
- ✅ Все тесты проходят (включая проблемные кейсы из истории багов).
- ✅ Публичный API совместим.
- ✅ Код проще: меньше уровней вложенности/абстракций; нет мёртвого кода.
- ✅ Короткая инженерная записка (`REFACTORING.md`, 1 страница): что изменили и почему.

## 5) Формат результата
- PR с атомарными коммитами и человеческим описанием.
- `REFACTORING.md` (1 страница) .
- (Опционально) 2–3 небольших теста, фиксирующих граничные случаи.

## 6) Предпочтительный рабочий процесс (можно менять)
1. Прогнать тесты → выписать красные кейсы.
2. Минимальными изменениями вернуть корректность.
3. Постепенно упрощать, сохраняя зелёные тесты.
4. Обновить краткую документацию.

## 7) Канал вопросов
Если чего-то не хватает (неясный контракт, скрытая зависимость, нестабильный тест) — задать 1–3 конкретных вопроса с предложением вариантов.
